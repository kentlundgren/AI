<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dagens Dubbel Analyssystem - Solvalla</title>
    
    <!-- =======================================================================
         FIREBASE INTEGRATION - UPPDATERING 2026-02-07
         =======================================================================
         M√∂nster A: Compat SDK + Firestore (Kent's enklaste m√∂nster)
         Anv√§nder Firebase SDK v10.7.0 f√∂r molnbaserad datalagring
         Data synkas mellan alla anv√§ndare i realtid
         ======================================================================= -->
    
    <!-- Firebase App (grundl√§ggande - kr√§vs alltid) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    
    <!-- Firebase Firestore (f√∂r databas) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase konfiguration och initialisering -->
    <script>
        // ============================================
        // FIREBASE INITIALISERING - UPPDATERING 2026-02-07
        // ============================================
        // Projekt: dagens-dubbel
        // Databas: Firestore (Cloud Firestore)
        // S√§kerhetsregler: Production mode med tillf√§lliga utvecklingsregler
        // ============================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyDrQs10JA1dE1Rf9pZjUGFI6PkCREs42zQ",
            authDomain: "dagens-dubbel.firebaseapp.com",
            projectId: "dagens-dubbel",
            storageBucket: "dagens-dubbel.firebasestorage.app",
            messagingSenderId: "982717111499",
            appId: "1:982717111499:web:250a78091cf957177dcf4e",
            measurementId: "G-1NZQ4SJ7F6"
        };

        // INITIERA FIREBASE
        firebase.initializeApp(firebaseConfig);
        
        // G√ñR FIRESTORE TILLG√ÑNGLIG GLOBALT
        const db = firebase.firestore();
        
        console.log("‚úÖ Firebase initierad! Projekt:", firebaseConfig.projectId);
        console.log("‚úÖ Firestore database tillg√§nglig");
    </script>
    
    <style>
        /* ========================================
           GRUNDL√ÑGGANDE STILAR
           ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* ========================================
           HEADER OCH NAVIGERING
           ======================================== */
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .version-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        /* Uppdatering 2026-02-07: Hover-effekt f√∂r GitHub-l√§nk i header */
        header a:hover {
            background: rgba(255,255,255,0.35) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* ========================================
           TABBAR NAVIGERING
           ======================================== */
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #495057;
            position: relative;
        }

        .tab-button:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-button.active {
            color: #667eea;
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }

        /* ========================================
           TAB INNEH√ÖLL
           ======================================== */
        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========================================
           FORMUL√ÑR OCH INPUT
           ======================================== */
        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid #dee2e6;
        }

        .section h2 {
            color: #2a5298;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #495057;
            margin: 20px 0 15px 0;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            /* Uppdatering 2026-02-07: Gul bakgrund f√∂r f√§lt som ska fyllas i manuellt */
            background-color: #fffacd;  /* Ljusgul - indikerar att f√§ltet ska fyllas i */
        }

        /* Uppdatering 2026-02-07: Insatsf√§lt (bet) ska INTE vara gula - de ber√§knas automatiskt */
        input[id$="-bet"],
        #weekNumber {
            background-color: #f8f9fa;  /* Ljusgr√•/vit - automatiskt f√§lt */
            font-weight: 600;
            color: #667eea;
            cursor: not-allowed;  /* Visar att f√§ltet inte kan redigeras */
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Uppdatering 2026-02-07: Gr√• bakgrund f√∂r sparad data */
        input.saved,
        textarea.saved {
            background-color: #e9ecef;  /* Ljusgr√• - indikerar att data √§r sparad */
        }
        
        /* Insatsf√§lt och veckonummer f√∂rblir ljusgr√• √§ven efter sparande */
        input[id$="-bet"].saved,
        #weekNumber.saved {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        /* ========================================
           SPELARE GRID
           ======================================== */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .player-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .player-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .player-card h4 {
            color: #2a5298;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .player-kent { background: #667eea; }
        .player-lotta { background: #f093fb; }
        .player-bengt { background: #4facfe; }
        .player-benita { background: #43e97b; }
        .player-system { background: #fa709a; }

        .horse-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .horse-input input {
            flex: 1;
        }

        /* ========================================
           KNAPPAR
           ======================================== */
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .button:active {
            transform: translateY(0);
        }

        .button-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .button-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .button-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        /* ========================================
           RESULTAT OCH STATISTIK
           ======================================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            color: white;
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85em;
            opacity: 0.8;
        }

        /* ========================================
           TABELL STILAR
           ======================================== */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .results-table th {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .results-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .results-table tr:last-child td {
            border-bottom: none;
        }

        /* ========================================
           BADGES OCH IKONER
           ======================================== */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-danger {
            background: #dc3545;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #333;
        }

        .badge-info {
            background: #17a2b8;
            color: white;
        }

        /* ========================================
           MEDDELANDEN
           ======================================== */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        /* ========================================
           RESPONSIV DESIGN
           ======================================== */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-button {
                border-bottom: 1px solid #dee2e6;
            }

            .players-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .button {
                width: 100%;
            }
        }

        /* ========================================
           HJ√ÑLPKLASSER
           ======================================== */
        .text-center {
            text-align: center;
        }

        .text-muted {
            color: #6c757d;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        /* ========================================
           LADDNINGSANIMERING
           ======================================== */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- ========================================
         HUVUD-CONTAINER
         ======================================== -->
    <div class="container">
        <!-- Header sektion -->
        <header>
            <h1>üèá Dagens Dubbel Analyssystem</h1>
            <p>Sj√§lvf√∂rb√§ttrande prediktionssystem f√∂r Solvalla L√∂rdagstrav</p>
            <span class="version-badge">Version 1.0 | 7 februari 2026</span>
            <p style="margin-top: 1rem;">
                <a href="https://github.com/kentlundgren/AI/tree/main/DagensDubbel" target="_blank" 
                   style="color: white; background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; 
                          border-radius: 5px; text-decoration: none; display: inline-block;
                          transition: background 0.3s ease;">
                    üíª Visa k√§llkod p√• GitHub
                </a>
            </p>
        </header>

        <!-- Tab-navigering -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('input')">üìù Inmatning</button>
            <button class="tab-button" onclick="switchTab('results')">üèÜ Resultat</button>
            <button class="tab-button" onclick="switchTab('analysis')">üìä Analys</button>
            <button class="tab-button" onclick="switchTab('history')">üìö Historik</button>
            <button class="tab-button" onclick="switchTab('prd')">üìÑ PRD-Update</button>
        </div>

        <!-- ========================================
             TAB 1: INMATNING
             ======================================== -->
        <div id="tab-input" class="tab-content active">
            <!-- Grundinformation -->
            <div class="section">
                <h2>Veckodata</h2>
                <div class="form-group">
                    <label for="raceDate">Datum f√∂r loppet:</label>
                    <input type="date" id="raceDate" value="2026-02-07">
                </div>
                <div class="form-group">
                    <label for="weekNumber">Veckonummer:</label>
                    <input type="number" id="weekNumber" min="1" readonly>
                </div>
                <div class="form-group">
                    <label for="raceNotes">Anteckningar om loppet (t.ex. STL-final, Margareta-serie):</label>
                    <textarea id="raceNotes" placeholder="Beskriv dagens lopp..."></textarea>
                </div>
            </div>

            <!-- Alla spelares satsningar -->
            <div class="section">
                <h2>Spelares satsningar</h2>
                <p class="text-muted mb-20">Ange vilka h√§star varje spelare satsat p√• i de tv√• loppen. Separera h√§star med komma (t.ex. "2,5,6").</p>
                
                <div class="players-grid">
                    <!-- Kent -->
                    <div class="player-card">
                        <h4><span class="player-icon player-kent">K</span>Kent</h4>
                        <div class="form-group">
                            <label>Lopp 1 (V85-7):</label>
                            <input type="text" id="kent-race1" placeholder="t.ex. 2,5,6" value="2,5,6">
                        </div>
                        <div class="form-group">
                            <label>Lopp 2 (V85-8):</label>
                            <input type="text" id="kent-race2" placeholder="t.ex. 6,11,15" value="6,11,15">
                        </div>
                        <div class="form-group">
                            <label>Insats (kr):</label>
                            <input type="number" id="kent-bet" min="0" readonly>
                        </div>
                    </div>

                    <!-- Lotta -->
                    <div class="player-card">
                        <h4><span class="player-icon player-lotta">L</span>Lotta</h4>
                        <div class="form-group">
                            <label>Lopp 1 (V85-7):</label>
                            <input type="text" id="lotta-race1" placeholder="t.ex. 5,6,8" value="5,6,8">
                        </div>
                        <div class="form-group">
                            <label>Lopp 2 (V85-8):</label>
                            <input type="text" id="lotta-race2" placeholder="t.ex. 10,13,15" value="10,13,15">
                        </div>
                        <div class="form-group">
                            <label>Insats (kr):</label>
                            <input type="number" id="lotta-bet" min="0" readonly>
                        </div>
                    </div>

                    <!-- Bengt -->
                    <div class="player-card">
                        <h4><span class="player-icon player-bengt">B</span>Bengt</h4>
                        <div class="form-group">
                            <label>Lopp 1 (V85-7):</label>
                            <input type="text" id="bengt-race1" placeholder="t.ex. 1,3,7" value="2,4,5,6,8">
                        </div>
                        <div class="form-group">
                            <label>Lopp 2 (V85-8):</label>
                            <input type="text" id="bengt-race2" placeholder="t.ex. 2,5,9" value="10">
                        </div>
                        <div class="form-group">
                            <label>Insats (kr):</label>
                            <input type="number" id="bengt-bet" min="0" readonly>
                        </div>
                    </div>

                    <!-- Benita -->
                    <div class="player-card">
                        <h4><span class="player-icon player-benita">B</span>Benita</h4>
                        <div class="form-group">
                            <label>Lopp 1 (V85-7):</label>
                            <input type="text" id="benita-race1" placeholder="t.ex. 4,6,9" value="4,5,6">
                        </div>
                        <div class="form-group">
                            <label>Lopp 2 (V85-8):</label>
                            <input type="text" id="benita-race2" placeholder="t.ex. 3,7,12" value="10,11">
                        </div>
                        <div class="form-group">
                            <label>Insats (kr):</label>
                            <input type="number" id="benita-bet" min="0" readonly>
                        </div>
                    </div>

                    <!-- Systemet (Claude) -->
                    <div class="player-card">
                        <h4><span class="player-icon player-system">ü§ñ</span>Systemet</h4>
                        <div class="form-group">
                            <label>Lopp 1 (V85-7):</label>
                            <input type="text" id="system-race1" placeholder="Genereras automatiskt" readonly>
                        </div>
                        <div class="form-group">
                            <label>Lopp 2 (V85-8):</label>
                            <input type="text" id="system-race2" placeholder="Genereras automatiskt" readonly>
                        </div>
                        <div class="form-group">
                            <label>Insats (kr):</label>
                            <input type="number" id="system-bet" value="0" readonly>
                        </div>
                        <button class="button button-secondary" onclick="generateSystemBet()" style="width: 100%; margin-top: 10px;">
                            üé≤ Generera systemets satsning
                        </button>
                    </div>
                </div>
            </div>

            <!-- Faktiska resultat -->
            <div class="section">
                <h2>Faktiska resultat (fylls i efter loppen)</h2>
                <div class="form-group">
                    <label for="winner-race1">Vinnare Lopp 1 (V85-7) - H√§stnummer:</label>
                    <input type="number" id="winner-race1" placeholder="t.ex. 5" min="1">
                </div>
                <div class="form-group">
                    <label for="winner-race2">Vinnare Lopp 2 (V85-8) - H√§stnummer:</label>
                    <input type="number" id="winner-race2" placeholder="t.ex. 11" min="1">
                </div>
                <div class="form-group">
                    <label for="dd-payout">DD-odds (g√•nger pengarna):</label>
                    <input type="text" id="dd-payout" placeholder="t.ex. 70,08 eller 70.08" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="result-notes">Anteckningar om resultatet:</label>
                    <textarea id="result-notes" placeholder="T.ex. √∂verraskande vinnare, favorit gallopperade..."></textarea>
                </div>
            </div>

            <!-- Spara-knappar -->
            <div class="button-group">
                <button class="button button-success" onclick="saveWeekData()">üíæ Spara veckodata</button>
                <button class="button button-secondary" onclick="clearForm()">üóëÔ∏è Rensa formul√§r</button>
                <button class="button" onclick="switchTab('results')">‚û°Ô∏è G√• till Resultat</button>
            </div>
        </div>

        <!-- ========================================
             TAB 2: RESULTAT
             ======================================== -->
        <div id="tab-results" class="tab-content">
            <div class="section">
                <h2>Senaste veckans resultat</h2>
                <div id="latest-results">
                    <p class="text-muted text-center">Ingen data √§nnu. Fyll i inmatningsfliken f√∂rst.</p>
                </div>
            </div>

            <div class="section">
                <h2>Spelares prestanda</h2>
                <div id="player-performance">
                    <p class="text-muted text-center">Laddar statistik...</p>
                </div>
            </div>
        </div>

        <!-- ========================================
             TAB 3: ANALYS
             ======================================== -->
        <div id="tab-analysis" class="tab-content">
            <div class="section">
                <h2>Kumulativ statistik</h2>
                <div class="stats-grid" id="cumulative-stats">
                    <!-- Genereras dynamiskt -->
                </div>
            </div>

            <div class="section">
                <h2>ROI-j√§mf√∂relse</h2>
                <div id="roi-comparison">
                    <p class="text-muted text-center">Data laddas...</p>
                </div>
            </div>

            <div class="section">
                <h2>Insikter och m√∂nster</h2>
                <div id="insights">
                    <p class="text-muted text-center">Analyserar data...</p>
                </div>
            </div>
        </div>

        <!-- ========================================
             TAB 4: HISTORIK
             ======================================== -->
        <div id="tab-history" class="tab-content">
            <div class="section">
                <h2>Alla veckors resultat</h2>
                <table class="results-table" id="history-table">
                    <thead>
                        <tr>
                            <th>Vecka</th>
                            <th>Datum</th>
                            <th>Vinnare L1</th>
                            <th>Vinnare L2</th>
                            <th>DD-odds</th>
                            <th>Kent</th>
                            <th>Lotta</th>
                            <th>Bengt</th>
                            <th>Benita</th>
                            <th>System</th>
                        </tr>
                    </thead>
                    <tbody id="history-body">
                        <tr>
                            <td colspan="10" class="text-center text-muted">Ingen historik √§nnu</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="button-group">
                <button class="button button-secondary" onclick="exportHistoryCSV()">üì• Exportera till CSV</button>
                <button class="button button-danger" onclick="clearAllData()">üóëÔ∏è Rensa all data (OBS!)</button>
            </div>
        </div>

        <!-- ========================================
             TAB 5: PRD-UPDATE
             ======================================== -->
        <div id="tab-prd" class="tab-content">
            <div class="section">
                <h2>PRD Version 1.0 ‚Üí Version 1.1</h2>
                <div class="alert alert-info">
                    <strong>Information:</strong> Denna sektion genererar en uppdaterad version av PRD-dokumentet baserat p√• insamlad data och resultat.
                </div>

                <div class="form-group">
                    <label>Antal veckor analyserade:</label>
                    <div id="prd-weeks-analyzed" style="font-size: 1.2em; font-weight: bold; color: #667eea; padding: 10px;">
                        0 veckor
                    </div>
                </div>

                <div class="form-group">
                    <label>Viktjusteringar att inkludera i PRD:</label>
                    <div id="prd-weight-adjustments" style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
                        <p class="text-muted">Ingen data √§nnu</p>
                    </div>
                </div>

                <div class="form-group">
                    <label>Uppt√§ckta m√∂nster och insikter:</label>
                    <div id="prd-insights" style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
                        <p class="text-muted">Ingen data √§nnu</p>
                    </div>
                </div>

                <div class="button-group">
                    <button class="button" onclick="generatePRDUpdate()">üìù Generera PRD Update</button>
                    <button class="button button-success" onclick="downloadPRD()">üì• Ladda ner PRD som textfil</button>
                </div>

                <div id="prd-output" class="mt-20" style="display: none;">
                    <h3>Genererad PRD-uppdatering:</h3>
                    <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6; max-height: 600px; overflow-y: auto;">
                        <pre id="prd-text" style="white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 0.9em;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================
         JAVASCRIPT - HUVUDLOGIK
         ======================================== -->
    <script>
        // ========================================
        // GLOBALA VARIABLER OCH DATASTRUKTUR
        // ========================================
        
        /**
         * Huvuddatastruktur f√∂r att lagra all veckodata
         * Lagras i localStorage f√∂r persistens mellan sessioner
         */
        let weeklyData = [];

        /**
         * Spelare-konfiguration
         * Definierar alla spelare och deras egenskaper
         */
        const players = {
            kent: { name: 'Kent', icon: 'K', color: 'player-kent' },
            lotta: { name: 'Lotta', icon: 'L', color: 'player-lotta' },
            bengt: { name: 'Bengt', icon: 'B', color: 'player-bengt' },
            benita: { name: 'Benita', icon: 'B', color: 'player-benita' },
            system: { name: 'Systemet', icon: 'ü§ñ', color: 'player-system' }
        };

        // ========================================
        // INITIALIZATION - K√∂rs n√§r sidan laddas
        // ========================================
        
        /**
         * Laddar sparad data fr√•n localStorage n√§r sidan laddas
         */
        // ============================================
        // AUTOMATISK INSATSBER√ÑKNING - UPPDATERING 2026-02-07
        // ============================================
        // Formel: antal_h√§star_lopp1 √ó antal_h√§star_lopp2 √ó 5 kr
        // Exempel: 3 h√§star √ó 3 h√§star √ó 5kr = 45kr
        // ============================================

        /**
         * Ber√§knar antal kommaseparerade v√§rden i en str√§ng
         * @param {string} str - Str√§ng med kommaseparerade v√§rden (t.ex. "2,5,6")
         * @returns {number} - Antal v√§rden
         */
        function countHorses(str) {
            if (!str || str.trim() === '') return 0;
            return str.split(',').filter(s => s.trim() !== '').length;
        }

        /**
         * Ber√§knar insats f√∂r en spelare baserat p√• antal h√§star i varje lopp
         * @param {string} playerId - Spelarens prefix (kent, lotta, bengt, benita, system)
         */
        function calculateBet(playerId) {
            const race1Input = document.getElementById(`${playerId}-race1`);
            const race2Input = document.getElementById(`${playerId}-race2`);
            const betInput = document.getElementById(`${playerId}-bet`);

            if (!race1Input || !race2Input || !betInput) return;

            const horsesRace1 = countHorses(race1Input.value);
            const horsesRace2 = countHorses(race2Input.value);

            // Ber√§kna insats: antal_lopp1 √ó antal_lopp2 √ó 5 kr
            const calculatedBet = horsesRace1 * horsesRace2 * 5;

            // Uppdatera f√§ltet
            betInput.value = calculatedBet;

            console.log(`${playerId}: ${horsesRace1} √ó ${horsesRace2} √ó 5kr = ${calculatedBet}kr`);
        }

        /**
         * L√§gger till event listeners f√∂r automatisk insatsber√§kning f√∂r alla spelare
         */
        function setupBetCalculation() {
            const players = ['kent', 'lotta', 'bengt', 'benita', 'system'];

            players.forEach(playerId => {
                const race1Input = document.getElementById(`${playerId}-race1`);
                const race2Input = document.getElementById(`${playerId}-race2`);

                if (race1Input && race2Input) {
                    // Ber√§kna n√§r anv√§ndaren skriver
                    race1Input.addEventListener('input', () => calculateBet(playerId));
                    race2Input.addEventListener('input', () => calculateBet(playerId));

                    // Ber√§kna direkt vid laddning om v√§rden finns
                    if (race1Input.value && race2Input.value) {
                        calculateBet(playerId);
                    }
                }
            });

            console.log('‚úÖ Automatisk insatsber√§kning aktiverad f√∂r alla spelare');
        }

        window.onload = function() {
            // Ladda fr√•n localStorage f√∂rst (snabbt)
            loadDataFromStorage();
            updateAllDisplays();
            setDefaultDate();
            
            // UPPDATERING 2026-02-07: Automatisk insatsber√§kning
            setupBetCalculation();
            
            // UPPDATERING 2026-02-07: Automatisk veckonummerber√§kning
            setupWeekNumberCalculation();
            
            // UPPDATERING 2026-02-07: Komma/punkt-hantering f√∂r decimalf√§lt
            setupDecimalInputHandling();
            
            // UPPDATERING 2026-02-07: F√§rgkodning av input-f√§lt (gul ‚Üí gr√•)
            setupFieldColorReset();
            
            // UPPDATERING 2026-02-07: Lyssna p√• Firestore-uppdateringar (realtid)
            // Detta synkar data fr√•n molnet och uppdaterar UI automatiskt
            loadFromFirestore();
        };

        /**
         * S√§tter dagens datum som standard i formul√§ret
         */
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('raceDate').value = today;
            
            // UPPDATERING 2026-02-07: Ber√§kna veckonummer automatiskt
            calculateWeekNumber();
        }

        // ========================================
        // AUTOMATISK VECKONUMMERBER√ÑKNING - UPPDATERING 2026-02-07
        // ========================================

        /**
         * Ber√§knar ISO-veckonummer fr√•n ett datum
         * ISO-vecka b√∂rjar p√• m√•ndag och vecka 1 √§r veckan med f√∂rsta torsdagen i √•ret
         * @param {Date} date - Datum att ber√§kna veckonummer f√∂r
         * @returns {number} - ISO-veckonummer (1-53)
         */
        function getISOWeekNumber(date) {
            // Kopiera datum s√• vi inte √§ndrar originalet
            const d = new Date(date);
            
            // S√§tt till n√§rmaste torsdag (ISO-vecka regel)
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            
            // √Örets f√∂rsta dag
            const yearStart = new Date(d.getFullYear(), 0, 1);
            
            // Ber√§kna veckonummer
            const weekNumber = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            
            return weekNumber;
        }

        /**
         * Ber√§knar och uppdaterar veckonummer baserat p√• valt datum
         */
        function calculateWeekNumber() {
            const dateInput = document.getElementById('raceDate');
            const weekInput = document.getElementById('weekNumber');
            
            if (!dateInput.value) {
                weekInput.value = '';
                return;
            }
            
            // Skapa Date-objekt fr√•n input-v√§rde
            const selectedDate = new Date(dateInput.value + 'T12:00:00'); // L√§gg till tid f√∂r att undvika timezone-problem
            
            // Ber√§kna ISO-veckonummer
            const weekNumber = getISOWeekNumber(selectedDate);
            
            // Uppdatera f√§ltet
            weekInput.value = weekNumber;
            
            console.log(`üìÖ Datum: ${dateInput.value} ‚Üí Vecka ${weekNumber}`);
        }

        /**
         * L√§gger till event listener f√∂r automatisk veckonummerber√§kning
         */
        function setupWeekNumberCalculation() {
            const dateInput = document.getElementById('raceDate');
            
            if (dateInput) {
                // Ber√§kna n√§r anv√§ndaren √§ndrar datum
                dateInput.addEventListener('change', calculateWeekNumber);
                dateInput.addEventListener('input', calculateWeekNumber);
                
                console.log('‚úÖ Automatisk veckonummerber√§kning aktiverad');
            }
        }

        // ========================================
        // KOMMA/PUNKT-HANTERING - UPPDATERING 2026-02-07
        // ========================================

        /**
         * Konverterar komma till punkt i decimalf√§lt
         * Till√•ter b√•de "70,08" och "70.08" som inmatning
         */
        function setupDecimalInputHandling() {
            const ddPayoutInput = document.getElementById('dd-payout');
            
            if (ddPayoutInput) {
                // N√§r anv√§ndaren skriver eller klistrar in
                ddPayoutInput.addEventListener('input', function() {
                    // Ers√§tt komma med punkt
                    this.value = this.value.replace(',', '.');
                });
                
                // Extra s√§kerhet: n√§r f√§ltet l√§mnas
                ddPayoutInput.addEventListener('blur', function() {
                    this.value = this.value.replace(',', '.');
                });
                
                console.log('‚úÖ Komma/punkt-hantering aktiverad f√∂r DD-odds');
            }
        }

        // ========================================
        // TAB-NAVIGERING
        // ========================================
        
        /**
         * V√§xlar mellan olika flikar i gr√§nssnittet
         * @param {string} tabName - Namnet p√• fliken att visa
         */
        function switchTab(tabName) {
            // D√∂lj alla flikar
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => tab.classList.remove('active'));

            // D√∂lj alla tab-knappar som aktiva
            const allButtons = document.querySelectorAll('.tab-button');
            allButtons.forEach(btn => btn.classList.remove('active'));

            // Visa vald flik
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // Markera vald tab-knapp
            event.target.classList.add('active');

            // Uppdatera inneh√•llet i den nya fliken
            updateTabContent(tabName);
        }

        /**
         * Uppdaterar inneh√•llet i en specifik flik
         * @param {string} tabName - Namnet p√• fliken att uppdatera
         */
        function updateTabContent(tabName) {
            switch(tabName) {
                case 'results':
                    displayLatestResults();
                    displayPlayerPerformance();
                    break;
                case 'analysis':
                    displayCumulativeStats();
                    displayROIComparison();
                    generateInsights();
                    break;
                case 'history':
                    displayFullHistory();
                    break;
                case 'prd':
                    updatePRDSection();
                    break;
            }
        }

        // ========================================
        // SYSTEMETS SATSNINGSGENERERING
        // ========================================
        
        /**
         * Genererar en slumpm√§ssig satsning f√∂r systemet
         * V√§ljer 2-4 h√§star per lopp och insats mellan 35-50 kr
         */
        function generateSystemBet() {
            // UPPDATERING 2026-02-07: Generera satsning som ger insats mellan 30-50 kr
            // Formel: insats = antal_h√§star_lopp1 √ó antal_h√§star_lopp2 √ó 5 kr
            // M√•linsats: 30-50 kr = 6-10 rader
            
            const targetRows = Math.floor(Math.random() * 5) + 6; // 6-10 rader
            
            // Hitta faktorpar som ger targetRows (t.ex. 6 = 3√ó2, 2√ó3, 6√ó1, 1√ó6)
            const factorPairs = [];
            for (let i = 1; i <= targetRows; i++) {
                if (targetRows % i === 0) {
                    const j = targetRows / i;
                    if (i >= 1 && i <= 5 && j >= 1 && j <= 5) { // Max 5 h√§star per lopp
                        factorPairs.push([i, j]);
                    }
                }
            }
            
            // Om inga faktorer hittas (t.ex. primtal > 5), anv√§nd fallback
            if (factorPairs.length === 0) {
                factorPairs.push([3, 3]); // Default: 45 kr
            }
            
            // V√§lj ett slumpm√§ssigt faktorpar
            const [numHorsesRace1, numHorsesRace2] = factorPairs[Math.floor(Math.random() * factorPairs.length)];

            // Generera unika h√§stnummer f√∂r lopp 1 och 2
            const race1Horses = generateUniqueRandomNumbers(numHorsesRace1, 1, 12);
            const race2Horses = generateUniqueRandomNumbers(numHorsesRace2, 1, 15);

            // Uppdatera formul√§r (insatsen ber√§knas automatiskt av calculateBet)
            document.getElementById('system-race1').value = race1Horses.sort((a, b) => a - b).join(',');
            document.getElementById('system-race2').value = race2Horses.sort((a, b) => a - b).join(',');

            // UPPDATERING 2026-02-07: Ber√§kna insats automatiskt
            calculateBet('system');
            
            const calculatedBet = document.getElementById('system-bet').value;

            // Visa bekr√§ftelse
            showNotification(`Systemets satsning genererad! ${numHorsesRace1} √ó ${numHorsesRace2} = ${calculatedBet} kr`, 'success');
        }

        /**
         * Genererar unika slumpm√§ssiga nummer inom ett intervall
         * @param {number} count - Antal nummer att generera
         * @param {number} min - Minsta v√§rde
         * @param {number} max - St√∂rsta v√§rde
         * @returns {Array} - Array med unika nummer
         */
        function generateUniqueRandomNumbers(count, min, max) {
            const numbers = [];
            while (numbers.length < count) {
                const num = Math.floor(Math.random() * (max - min + 1)) + min;
                if (!numbers.includes(num)) {
                    numbers.push(num);
                }
            }
            return numbers;
        }

        // ========================================
        // DATA SPARA/LADDA
        // ========================================
        
        /**
         * Sparar veckodata till localStorage och uppdaterar visningen
         */
        function saveWeekData() {
            try {
                // Samla data fr√•n formul√§r
                const weekData = {
                    week: parseInt(document.getElementById('weekNumber').value),
                    date: document.getElementById('raceDate').value,
                    notes: document.getElementById('raceNotes').value,
                    
                    // Spelares satsningar
                    players: {
                        kent: {
                            race1: parseHorses(document.getElementById('kent-race1').value),
                            race2: parseHorses(document.getElementById('kent-race2').value),
                            bet: parseFloat(document.getElementById('kent-bet').value)
                        },
                        lotta: {
                            race1: parseHorses(document.getElementById('lotta-race1').value),
                            race2: parseHorses(document.getElementById('lotta-race2').value),
                            bet: parseFloat(document.getElementById('lotta-bet').value)
                        },
                        bengt: {
                            race1: parseHorses(document.getElementById('bengt-race1').value),
                            race2: parseHorses(document.getElementById('bengt-race2').value),
                            bet: parseFloat(document.getElementById('bengt-bet').value)
                        },
                        benita: {
                            race1: parseHorses(document.getElementById('benita-race1').value),
                            race2: parseHorses(document.getElementById('benita-race2').value),
                            bet: parseFloat(document.getElementById('benita-bet').value)
                        },
                        system: {
                            race1: parseHorses(document.getElementById('system-race1').value),
                            race2: parseHorses(document.getElementById('system-race2').value),
                            bet: parseFloat(document.getElementById('system-bet').value)
                        }
                    },
                    
                    // Faktiska resultat
                    results: {
                        winner_race1: parseInt(document.getElementById('winner-race1').value) || null,
                        winner_race2: parseInt(document.getElementById('winner-race2').value) || null,
                        dd_payout: parseFloat(document.getElementById('dd-payout').value) || 0,
                        notes: document.getElementById('result-notes').value
                    },
                    
                    timestamp: new Date().toISOString()
                };

                // Validering
                if (!weekData.date) {
                    showNotification('Datum m√•ste anges!', 'error');
                    return;
                }

                // Kolla om vecka redan finns
                const existingIndex = weeklyData.findIndex(w => w.week === weekData.week);
                if (existingIndex >= 0) {
                    // Uppdatera befintlig
                    weeklyData[existingIndex] = weekData;
                    showNotification('Vecka ' + weekData.week + ' uppdaterad!', 'success');
                } else {
                    // L√§gg till ny
                    weeklyData.push(weekData);
                    showNotification('Vecka ' + weekData.week + ' sparad!', 'success');
                }

                // Sortera efter vecka
                weeklyData.sort((a, b) => a.week - b.week);

                // Spara till localStorage
                localStorage.setItem('ddWeeklyData', JSON.stringify(weeklyData));

                // UPPDATERING 2026-02-07: Spara √§ven till Firestore
                saveToFirestore(weekData);

                // Uppdatera alla visningar
                updateAllDisplays();

                // Ber√§kna och visa vinnare
                if (weekData.results.winner_race1 && weekData.results.winner_race2) {
                    calculateWeekWinners(weekData);
                }

                // UPPDATERING 2026-02-07: Markera alla input-f√§lt som sparade (gr√•)
                markFieldsAsSaved();

            } catch (error) {
                console.error('Fel vid sparande:', error);
                showNotification('Fel vid sparande: ' + error.message, 'error');
            }
        }

        // ============================================
        // F√ÑRGKODNING AV INPUT-F√ÑLT - UPPDATERING 2026-02-07
        // ============================================
        // Gul (tom) ‚Üí Gr√• (sparad)
        // ============================================

        /**
         * Markerar alla input-f√§lt och textareas som "saved" (gr√• bakgrund)
         * Anropas efter att data har sparats
         */
        function markFieldsAsSaved() {
            // H√§mta alla input-f√§lt och textareas i spelarkorten och resultat-sektionen
            const inputs = document.querySelectorAll('input[type="text"], input[type="number"], textarea');
            
            inputs.forEach(input => {
                input.classList.add('saved');
            });

            console.log('‚úÖ Alla f√§lt markerade som sparade (gr√• bakgrund)');
        }

        /**
         * √Öterst√§ller f√§rgkodning (tar bort "saved" class) n√§r anv√§ndaren b√∂rjar redigera
         * Detta g√∂rs automatiskt n√§r anv√§ndaren √§ndrar n√•got i formul√§ret
         */
        function setupFieldColorReset() {
            const inputs = document.querySelectorAll('input[type="text"], input[type="number"], textarea');
            
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.classList.remove('saved');
                });
            });

            console.log('‚úÖ F√§rgkodning kommer att √•terst√§llas vid redigering');
        }

        /**
         * Parsar en str√§ng med h√§stnummer till en array
         * @param {string} str - Str√§ng med kommaseparerade nummer (t.ex. "2,5,6")
         * @returns {Array} - Array med h√§stnummer
         */
        function parseHorses(str) {
            if (!str || str.trim() === '') return [];
            return str.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
        }

        /**
         * Laddar data fr√•n localStorage
         */
        function loadDataFromStorage() {
            const stored = localStorage.getItem('ddWeeklyData');
            if (stored) {
                try {
                    weeklyData = JSON.parse(stored);
                    console.log('Data laddad:', weeklyData.length, 'veckor');
                } catch (error) {
                    console.error('Fel vid laddning av data:', error);
                    weeklyData = [];
                }
            }
        }

        // ============================================
        // FIREBASE FUNKTIONER - UPPDATERING 2026-02-07
        // ============================================
        // M√∂nster A: Compat SDK + Firestore
        // Hybrid-l√∂sning: localStorage som cache + Firestore som molnbackend
        // ============================================

        /**
         * Sparar veckodata till Firestore (Cloud Firestore)
         * @param {Object} weekData - Veckans data att spara
         */
        function saveToFirestore(weekData) {
            try {
                // UPPDATERING 2026-02-07: Anv√§nd veckonummer som dokument-ID
                // Detta s√§kerst√§ller att samma vecka uppdateras ist√§llet f√∂r att skapa dubbletter
                const weekDocId = 'week-' + weekData.week;
                
                db.collection('dagensDubbel')
                    .doc('veckor')
                    .collection('items')
                    .doc(weekDocId)  // Anv√§nd veckonummer som ID
                    .set({
                        ...weekData,
                        firestoreTimestamp: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true })  // merge: true = uppdatera befintligt eller skapa nytt
                    .then(() => {
                        console.log('‚úÖ Vecka', weekData.week, 'sparad/uppdaterad i Firestore');
                    })
                    .catch((error) => {
                        console.error('‚ùå Firestore-fel vid sparande:', error);
                        // Ingen alert - localStorage √§r redan sparad
                    });
            } catch (error) {
                console.error('‚ùå Firebase-exception:', error);
            }
        }

        /**
         * Laddar data fr√•n Firestore i realtid
         * Lyssnar p√• √§ndringar och uppdaterar UI automatiskt
         */
        function loadFromFirestore() {
            try {
                // ONSNAPSHOT = LYSSNAR P√Ö √ÑNDRINGAR I REALTID
                db.collection('dagensDubbel')
                    .doc('veckor')
                    .collection('items')
                    .orderBy('week', 'asc')  // Sortera efter veckonummer
                    .onSnapshot((snapshot) => {
                        console.log('üì• Firestore-uppdatering mottagen');
                        
                        const firestoreWeeks = [];
                        const seenWeeks = new Set();  // UPPDATERING 2026-02-07: Undvik dubbletter
                        
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            
                            // UPPDATERING 2026-02-07: Ta bara senaste versionen av varje vecka
                            if (!seenWeeks.has(data.week)) {
                                seenWeeks.add(data.week);
                                firestoreWeeks.push({
                                    firestoreId: doc.id,  // Spara Firestore-ID
                                    ...data
                                });
                            } else {
                                console.warn('‚ö†Ô∏è Dublett hittad f√∂r vecka', data.week, '- ignorerar');
                            }
                        });
                        
                        console.log(`Firestore har ${firestoreWeeks.length} unika veckor`);
                        
                        // SYNKA MED LOCALSTORAGE
                        if (firestoreWeeks.length > 0) {
                            weeklyData = firestoreWeeks;
                            localStorage.setItem('ddWeeklyData', JSON.stringify(weeklyData));
                            updateAllDisplays();
                            console.log('‚úÖ Data synkad fr√•n Firestore till localStorage');
                        }
                        
                    }, (error) => {
                        console.error('‚ùå Fel vid l√§sning fr√•n Firestore:', error);
                    });
            } catch (error) {
                console.error('‚ùå Firebase-exception vid l√§sning:', error);
            }
        }

        /**
         * UPPDATERING 2026-02-07: Rensar dubbletter fr√•n Firestore
         * K√∂r denna funktion EN G√ÖNG fr√•n console om du har dubbletter
         */
        function cleanFirestoreDuplicates() {
            if (!confirm('‚ö†Ô∏è Detta kommer att rensa alla gamla dubbletter fr√•n Firestore.\n\nForts√§tt?')) {
                return;
            }
            
            console.log('üßπ Startar rensning av dubbletter...');
            
            db.collection('dagensDubbel')
                .doc('veckor')
                .collection('items')
                .get()
                .then((snapshot) => {
                    const weekGroups = {};  // Gruppera dokument per veckonummer
                    
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        const weekNum = data.week;
                        
                        if (!weekGroups[weekNum]) {
                            weekGroups[weekNum] = [];
                        }
                        
                        weekGroups[weekNum].push({
                            id: doc.id,
                            timestamp: data.firestoreTimestamp || data.timestamp || '',
                            data: data
                        });
                    });
                    
                    // F√∂r varje veckonummer, beh√•ll bara den senaste
                    let deletePromises = [];
                    
                    Object.keys(weekGroups).forEach(weekNum => {
                        const docs = weekGroups[weekNum];
                        
                        if (docs.length > 1) {
                            console.log(`‚ö†Ô∏è Vecka ${weekNum} har ${docs.length} dubbletter`);
                            
                            // Sortera efter timestamp (senaste f√∂rst)
                            docs.sort((a, b) => {
                                if (!a.timestamp) return 1;
                                if (!b.timestamp) return -1;
                                return b.timestamp - a.timestamp;
                            });
                            
                            // Ta bort alla utom den senaste
                            for (let i = 1; i < docs.length; i++) {
                                console.log(`  üóëÔ∏è Raderar gammal version: ${docs[i].id}`);
                                deletePromises.push(
                                    db.collection('dagensDubbel')
                                        .doc('veckor')
                                        .collection('items')
                                        .doc(docs[i].id)
                                        .delete()
                                );
                            }
                        }
                    });
                    
                    return Promise.all(deletePromises);
                })
                .then(() => {
                    console.log('‚úÖ Rensning klar!');
                    alert('‚úÖ Dubbletter har rensats fr√•n Firestore!\n\nLadda om sidan f√∂r att se uppdaterad data.');
                })
                .catch((error) => {
                    console.error('‚ùå Fel vid rensning:', error);
                    alert('‚ùå N√•got gick fel vid rensning: ' + error.message);
                });
        }

        /**
         * Raderar en vecka fr√•n Firestore
         * @param {string} firestoreId - Firestore-dokumentets ID
         */
        function deleteWeekFromFirestore(firestoreId) {
            if (!firestoreId) {
                console.warn('Inget Firestore-ID att radera');
                return;
            }
            
            if (!confirm('Radera denna vecka fr√•n molnet ocks√•?')) {
                return;
            }
            
            try {
                db.collection('dagensDubbel')
                    .doc('veckor')
                    .collection('items')
                    .doc(firestoreId)
                    .delete()
                    .then(() => {
                        console.log('‚úÖ Vecka raderad fr√•n Firestore');
                    })
                    .catch((error) => {
                        console.error('‚ùå Fel vid radering fr√•n Firestore:', error);
                    });
            } catch (error) {
                console.error('‚ùå Firebase-exception vid radering:', error);
            }
        }

        /**
         * Uppdaterar alla visningar i gr√§nssnittet
         */
        function updateAllDisplays() {
            displayLatestResults();
            displayPlayerPerformance();
            displayCumulativeStats();
            displayROIComparison();
            generateInsights();
            displayFullHistory();
            updatePRDSection();
        }

        // ========================================
        // BER√ÑKNINGAR OCH ANALYS
        // ========================================
        
        /**
         * Ber√§knar vinnare f√∂r en specifik vecka
         * @param {Object} weekData - Data f√∂r veckan
         */
        function calculateWeekWinners(weekData) {
            const winner1 = weekData.results.winner_race1;
            const winner2 = weekData.results.winner_race2;
            const payout = weekData.results.dd_payout;

            let resultsHTML = '<h3>Veckans vinnare:</h3><ul>';

            // Kontrollera varje spelare
            Object.keys(weekData.players).forEach(playerId => {
                const player = weekData.players[playerId];
                const hasWinner1 = player.race1.includes(winner1);
                const hasWinner2 = player.race2.includes(winner2);
                const hit = hasWinner1 && hasWinner2;

                const playerName = players[playerId].name;
                
                if (hit) {
                    const winAmount = payout - player.bet;
                    resultsHTML += `<li><strong>${playerName}</strong>: ‚úÖ TR√ÑFF! Vinst: ${winAmount.toFixed(2)} kr (Netto: +${(payout - player.bet).toFixed(2)} kr)</li>`;
                } else {
                    resultsHTML += `<li><strong>${playerName}</strong>: ‚ùå Ingen tr√§ff (F√∂rlust: -${player.bet} kr)</li>`;
                }
            });

            resultsHTML += '</ul>';
            
            // Visa i en tempor√§r alert
            showNotification('Vecka ' + weekData.week + ' analyserad!', 'success');
        }

        /**
         * Visar senaste veckans resultat
         */
        function displayLatestResults() {
            const container = document.getElementById('latest-results');
            
            if (weeklyData.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">Ingen data √§nnu. Fyll i inmatningsfliken f√∂rst.</p>';
                return;
            }

            const latest = weeklyData[weeklyData.length - 1];
            
            let html = `
                <div class="alert alert-info">
                    <strong>Vecka ${latest.week}</strong> | ${formatDate(latest.date)}<br>
                    ${latest.notes ? latest.notes : ''}
                </div>
            `;

            if (latest.results.winner_race1 && latest.results.winner_race2) {
                html += `
                    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3>Faktiska resultat:</h3>
                        <p><strong>Lopp 1 vinnare:</strong> H√§st #${latest.results.winner_race1}</p>
                        <p><strong>Lopp 2 vinnare:</strong> H√§st #${latest.results.winner_race2}</p>
                        <p><strong>DD-odds:</strong> ${latest.results.dd_payout.toFixed(2)}x</p>
                        ${latest.results.notes ? `<p><em>${latest.results.notes}</em></p>` : ''}
                    </div>
                `;

                // Visa varje spelares resultat
                html += '<h3>Spelares resultat:</h3>';
                html += '<div class="players-grid">';

                Object.keys(latest.players).forEach(playerId => {
                    const player = latest.players[playerId];
                    const hasWinner1 = player.race1.includes(latest.results.winner_race1);
                    const hasWinner2 = player.race2.includes(latest.results.winner_race2);
                    const ddHit = hasWinner1 && hasWinner2;

                    const playerInfo = players[playerId];
                    
                    html += `
                        <div class="player-card">
                            <h4><span class="player-icon ${playerInfo.color}">${playerInfo.icon}</span>${playerInfo.name}</h4>
                            <p><strong>Lopp 1:</strong> ${player.race1.join(', ')} ${hasWinner1 ? '‚úÖ' : '‚ùå'}</p>
                            <p><strong>Lopp 2:</strong> ${player.race2.join(', ')} ${hasWinner2 ? '‚úÖ' : '‚ùå'}</p>
                            <p><strong>Insats:</strong> ${player.bet} kr</p>
                            ${ddHit ? 
                                `<div class="badge badge-success" style="display: block; margin-top: 10px; text-align: center;">DD-TR√ÑFF! Utdelning: ${(latest.results.dd_payout * player.bet).toFixed(2)} kr (Vinst: +${(player.bet * (latest.results.dd_payout - 1)).toFixed(2)} kr)</div>` :
                                `<div class="badge badge-danger" style="display: block; margin-top: 10px; text-align: center;">Ingen tr√§ff (F√∂rlust: -${player.bet} kr)</div>`
                            }
                        </div>
                    `;
                });

                html += '</div>';
            } else {
                html += '<p class="text-muted">Resultat har inte fyllts i √§n f√∂r denna vecka.</p>';
            }

            container.innerHTML = html;
        }

        /**
         * Visar alla spelares samlade prestanda
         */
        function displayPlayerPerformance() {
            const container = document.getElementById('player-performance');
            
            if (weeklyData.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">Ingen data √§nnu.</p>';
                return;
            }

            // Ber√§kna statistik f√∂r varje spelare
            const stats = {};
            Object.keys(players).forEach(playerId => {
                stats[playerId] = {
                    totalBet: 0,
                    totalWin: 0,
                    ddHits: 0,
                    race1Hits: 0,
                    race2Hits: 0,
                    weeks: 0
                };
            });

            weeklyData.forEach(week => {
                if (!week.results.winner_race1 || !week.results.winner_race2) return;

                Object.keys(week.players).forEach(playerId => {
                    const player = week.players[playerId];
                    const hasWinner1 = player.race1.includes(week.results.winner_race1);
                    const hasWinner2 = player.race2.includes(week.results.winner_race2);
                    const ddHit = hasWinner1 && hasWinner2;

                    stats[playerId].totalBet += player.bet;
                    if (ddHit) {
                        stats[playerId].totalWin += week.results.dd_payout;
                        stats[playerId].ddHits++;
                    }
                    if (hasWinner1) stats[playerId].race1Hits++;
                    if (hasWinner2) stats[playerId].race2Hits++;
                    stats[playerId].weeks++;
                });
            });

            // Rendera tabell
            let html = '<table class="results-table"><thead><tr>';
            html += '<th>Spelare</th><th>Veckor</th><th>Total insats</th><th>Total vinst</th><th>Netto</th><th>ROI</th><th>DD-tr√§ffar</th><th>L1 tr√§ffar</th><th>L2 tr√§ffar</th>';
            html += '</tr></thead><tbody>';

            Object.keys(stats).forEach(playerId => {
                const s = stats[playerId];
                if (s.weeks === 0) return;

                const netto = s.totalWin - s.totalBet;
                const roi = s.totalBet > 0 ? ((netto / s.totalBet) * 100) : 0;
                const playerInfo = players[playerId];

                html += `<tr>
                    <td><span class="player-icon ${playerInfo.color}">${playerInfo.icon}</span> ${playerInfo.name}</td>
                    <td>${s.weeks}</td>
                    <td>${s.totalBet.toFixed(2)} kr</td>
                    <td>${s.totalWin.toFixed(2)} kr</td>
                    <td style="color: ${netto >= 0 ? 'green' : 'red'}; font-weight: bold;">${netto >= 0 ? '+' : ''}${netto.toFixed(2)} kr</td>
                    <td style="color: ${roi >= 0 ? 'green' : 'red'}; font-weight: bold;">${roi >= 0 ? '+' : ''}${roi.toFixed(1)}%</td>
                    <td>${s.ddHits} (${s.weeks > 0 ? ((s.ddHits/s.weeks)*100).toFixed(1) : 0}%)</td>
                    <td>${s.race1Hits} (${s.weeks > 0 ? ((s.race1Hits/s.weeks)*100).toFixed(1) : 0}%)</td>
                    <td>${s.race2Hits} (${s.weeks > 0 ? ((s.race2Hits/s.weeks)*100).toFixed(1) : 0}%)</td>
                </tr>`;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        /**
         * Visar kumulativ statistik
         */
        function displayCumulativeStats() {
            const container = document.getElementById('cumulative-stats');
            
            if (weeklyData.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">Ingen data √§nnu.</p>';
                return;
            }

            // R√§kna antal veckor med resultat
            const weeksWithResults = weeklyData.filter(w => w.results.winner_race1 && w.results.winner_race2).length;
            
            // Total DD-tr√§ffar
            let totalDDHits = 0;
            let totalWeeks = 0;
            
            weeklyData.forEach(week => {
                if (!week.results.winner_race1 || !week.results.winner_race2) return;
                totalWeeks++;
                
                Object.values(week.players).forEach(player => {
                    const hasWinner1 = player.race1.includes(week.results.winner_race1);
                    const hasWinner2 = player.race2.includes(week.results.winner_race2);
                    if (hasWinner1 && hasWinner2) totalDDHits++;
                });
            });

            const avgDDHitRate = totalWeeks > 0 ? ((totalDDHits / (totalWeeks * 5)) * 100) : 0; // 5 spelare

            let html = `
                <div class="stat-card">
                    <h3>Veckor analyserade</h3>
                    <div class="stat-value">${weeksWithResults}</div>
                    <div class="stat-label">av ${weeklyData.length} totalt</div>
                </div>
                <div class="stat-card">
                    <h3>DD-tr√§ffar totalt</h3>
                    <div class="stat-value">${totalDDHits}</div>
                    <div class="stat-label">alla spelare</div>
                </div>
                <div class="stat-card">
                    <h3>Genomsnittlig tr√§ff%</h3>
                    <div class="stat-value">${avgDDHitRate.toFixed(1)}%</div>
                    <div class="stat-label">per spelare/vecka</div>
                </div>
                <div class="stat-card">
                    <h3>Systemversion</h3>
                    <div class="stat-value">1.0</div>
                    <div class="stat-label">Initial release</div>
                </div>
            `;

            container.innerHTML = html;
        }

        /**
         * Visar ROI-j√§mf√∂relse mellan spelare
         */
        function displayROIComparison() {
            const container = document.getElementById('roi-comparison');
            
            if (weeklyData.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">Ingen data √§nnu.</p>';
                return;
            }

            // R√§kna ut ROI per spelare
            const roiData = {};
            Object.keys(players).forEach(playerId => {
                roiData[playerId] = { bet: 0, win: 0 };
            });

            weeklyData.forEach(week => {
                if (!week.results.winner_race1 || !week.results.winner_race2) return;

                Object.keys(week.players).forEach(playerId => {
                    const player = week.players[playerId];
                    const hasWinner1 = player.race1.includes(week.results.winner_race1);
                    const hasWinner2 = player.race2.includes(week.results.winner_race2);
                    
                    roiData[playerId].bet += player.bet;
                    if (hasWinner1 && hasWinner2) {
                        // UPPDATERING 2026-02-07: dd_payout √§r odds, inte kr
                        // Utdelning = odds √ó insats
                        roiData[playerId].win += week.results.dd_payout * player.bet;
                    }
                });
            });

            // Sortera efter ROI
            const sorted = Object.keys(roiData)
                .map(playerId => ({
                    id: playerId,
                    ...roiData[playerId],
                    roi: roiData[playerId].bet > 0 ? (((roiData[playerId].win - roiData[playerId].bet) / roiData[playerId].bet) * 100) : 0
                }))
                .sort((a, b) => b.roi - a.roi);

            let html = '<div style="display: flex; flex-direction: column; gap: 15px;">';
            
            sorted.forEach((data, index) => {
                const playerInfo = players[data.id];
                const netto = data.win - data.bet;
                
                html += `
                    <div style="background: white; padding: 20px; border-radius: 8px; border: 2px solid ${data.roi >= 0 ? '#28a745' : '#dc3545'}; position: relative;">
                        <div style="position: absolute; top: 10px; right: 10px; font-size: 2em; opacity: 0.2;">${index + 1}</div>
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <span class="player-icon ${playerInfo.color}" style="width: 50px; height: 50px; font-size: 1.5em;">${playerInfo.icon}</span>
                            <div style="flex: 1;">
                                <h3 style="margin: 0; color: #2a5298;">${playerInfo.name}</h3>
                                <p style="margin: 5px 0 0 0; color: #6c757d;">ROI: <strong style="color: ${data.roi >= 0 ? 'green' : 'red'}; font-size: 1.3em;">${data.roi >= 0 ? '+' : ''}${data.roi.toFixed(1)}%</strong></p>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px;">
                            <div>
                                <div style="font-size: 0.8em; color: #6c757d;">Total insats</div>
                                <div style="font-weight: bold;">${data.bet.toFixed(2)} kr</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8em; color: #6c757d;">Total vinst</div>
                                <div style="font-weight: bold;">${data.win.toFixed(2)} kr</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8em; color: #6c757d;">Netto</div>
                                <div style="font-weight: bold; color: ${netto >= 0 ? 'green' : 'red'};">${netto >= 0 ? '+' : ''}${netto.toFixed(2)} kr</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        /**
         * Genererar insikter och m√∂nster fr√•n data
         */
        function generateInsights() {
            const container = document.getElementById('insights');
            
            if (weeklyData.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">Ingen data √§nnu.</p>';
                return;
            }

            const weeksWithResults = weeklyData.filter(w => w.results.winner_race1 && w.results.winner_race2);
            
            if (weeksWithResults.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">Inga resultat att analysera √§nnu.</p>';
                return;
            }

            let insights = [];

            // Insikt 1: B√§sta spelare
            const playerStats = {};
            Object.keys(players).forEach(pid => playerStats[pid] = { hits: 0, weeks: 0 });
            
            weeksWithResults.forEach(week => {
                Object.keys(week.players).forEach(pid => {
                    const p = week.players[pid];
                    const hit = p.race1.includes(week.results.winner_race1) && p.race2.includes(week.results.winner_race2);
                    if (hit) playerStats[pid].hits++;
                    playerStats[pid].weeks++;
                });
            });

            const bestPlayer = Object.keys(playerStats).reduce((a, b) => 
                playerStats[a].hits > playerStats[b].hits ? a : b
            );
            insights.push(`üèÜ <strong>B√§sta spelare hittills:</strong> ${players[bestPlayer].name} med ${playerStats[bestPlayer].hits} DD-tr√§ffar p√• ${playerStats[bestPlayer].weeks} veckor (${((playerStats[bestPlayer].hits/playerStats[bestPlayer].weeks)*100).toFixed(1)}%)`);

            // Insikt 2: Genomsnittligt odds
            const avgPayout = weeksWithResults.reduce((sum, w) => sum + w.results.dd_payout, 0) / weeksWithResults.length;
            insights.push(`üí∞ <strong>Genomsnittligt DD-odds:</strong> ${avgPayout.toFixed(2)}x`);

            // Insikt 3: H√∂sta/l√§gsta utdelning
            const maxPayout = Math.max(...weeksWithResults.map(w => w.results.dd_payout));
            const minPayout = Math.min(...weeksWithResults.map(w => w.results.dd_payout));
            insights.push(`üìä <strong>Utdelningsspann:</strong> ${minPayout.toFixed(2)} kr (l√§gst) till ${maxPayout.toFixed(2)} kr (h√∂gst)`);

            // Insikt 4: Systemets prestanda vs genomsnitt
            if (playerStats.system && playerStats.system.weeks > 0) {
                const systemHitRate = (playerStats.system.hits / playerStats.system.weeks) * 100;
                const avgHitRate = Object.keys(playerStats).reduce((sum, pid) => {
                    return sum + (playerStats[pid].weeks > 0 ? (playerStats[pid].hits / playerStats[pid].weeks) : 0);
                }, 0) / Object.keys(playerStats).length * 100;
                
                if (systemHitRate > avgHitRate) {
                    insights.push(`ü§ñ <strong>Systemet presterar √∂ver genomsnittet!</strong> ${systemHitRate.toFixed(1)}% vs ${avgHitRate.toFixed(1)}% genomsnitt`);
                } else {
                    insights.push(`ü§ñ <strong>Systemet beh√∂ver f√∂rb√§ttras:</strong> ${systemHitRate.toFixed(1)}% vs ${avgHitRate.toFixed(1)}% genomsnitt`);
                }
            }

            let html = '<ul style="background: white; padding: 20px 40px; border-radius: 8px; line-height: 2;">';
            insights.forEach(insight => {
                html += `<li>${insight}</li>`;
            });
            html += '</ul>';

            container.innerHTML = html;
        }

        /**
         * Visar fullst√§ndig historik i tabell
         */
        function displayFullHistory() {
            const tbody = document.getElementById('history-body');
            
            if (weeklyData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="text-center text-muted">Ingen historik √§nnu</td></tr>';
                return;
            }

            let html = '';
            weeklyData.forEach(week => {
                const hasResults = week.results.winner_race1 && week.results.winner_race2;
                
                html += `<tr>
                    <td><strong>${week.week}</strong></td>
                    <td>${formatDate(week.date)}</td>
                    <td>${week.results.winner_race1 || '-'}</td>
                    <td>${week.results.winner_race2 || '-'}</td>
                    <td>${week.results.dd_payout > 0 ? week.results.dd_payout.toFixed(2) + 'x' : '-'}</td>
                `;

                if (hasResults) {
                    Object.keys(players).forEach(pid => {
                        const p = week.players[pid];
                        const hit = p.race1.includes(week.results.winner_race1) && p.race2.includes(week.results.winner_race2);
                        html += `<td>${hit ? '<span class="badge badge-success">TR√ÑFF</span>' : '<span class="badge badge-danger">Miss</span>'}</td>`;
                    });
                } else {
                    html += '<td colspan="5" class="text-center text-muted">Ej klart</td>';
                }

                html += '</tr>';
            });

            tbody.innerHTML = html;
        }

        /**
         * Uppdaterar PRD-sektionen
         */
        function updatePRDSection() {
            document.getElementById('prd-weeks-analyzed').textContent = weeklyData.length + ' veckor';
            
            // Placeholder - fylls i av generatePRDUpdate()
            if (weeklyData.length === 0) {
                document.getElementById('prd-weight-adjustments').innerHTML = '<p class="text-muted">Ingen data √§nnu</p>';
                document.getElementById('prd-insights').innerHTML = '<p class="text-muted">Ingen data √§nnu</p>';
            }
        }

        /**
         * Genererar PRD-uppdatering
         */
        function generatePRDUpdate() {
            if (weeklyData.length === 0) {
                showNotification('Ingen data att generera PRD fr√•n!', 'error');
                return;
            }

            // Detta skulle i en riktig app kalla Claude API f√∂r att generera uppdatering
            // F√∂r nu, visa en placeholder
            const prdText = `# PRODUCT REQUIREMENTS DOCUMENT (PRD)
## Sj√§lvf√∂rb√§ttrande Analyssystem f√∂r Dagens Dubbel ‚Äì Solvalla L√∂rdagstrav

**Version:** 1.1
**Datum:** ${new Date().toISOString().split('T')[0]}
**F√∂rfattare:** Kent Lundgren / Systemet
**Status:** Uppdaterad baserat p√• ${weeklyData.length} veckors data

---

## SAMMANFATTNING AV √ÑNDRINGAR SEDAN V1.0

### Dataunderlag
- **Antal veckor analyserade:** ${weeklyData.length}
- **Veckor med kompletta resultat:** ${weeklyData.filter(w => w.results.winner_race1).length}
- **Total DD-tr√§ffar:** [Ber√§knas vid generering]

### Prelimin√§ra insikter
[Genereras automatiskt baserat p√• insamlad data]

### Rekommenderade viktjusteringar
[Kommer fr√•n utv√§rderingsmotor]

---

*Fullst√§ndig PRD-uppdatering genereras av systemet baserat p√• faktisk data.*
            `;

            document.getElementById('prd-text').textContent = prdText;
            document.getElementById('prd-output').style.display = 'block';
            
            showNotification('PRD-utkast genererat! Se nedan.', 'success');
        }

        /**
         * Laddar ner PRD som textfil
         */
        function downloadPRD() {
            const prdContent = document.getElementById('prd-text').textContent;
            
            if (!prdContent || prdContent.trim() === '') {
                showNotification('Generera PRD f√∂rst!', 'error');
                return;
            }

            const blob = new Blob([prdContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'PRD_v1.1_' + new Date().toISOString().split('T')[0] + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('PRD nedladdad!', 'success');
        }

        // ========================================
        // HJ√ÑLPFUNKTIONER
        // ========================================
        
        /**
         * Formaterar datum till l√§sbar form
         * @param {string} dateStr - ISO-datumformat
         * @returns {string} - Formaterat datum
         */
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('sv-SE', options);
        }

        /**
         * Visar notifikation till anv√§ndaren
         * @param {string} message - Meddelande att visa
         * @param {string} type - Typ av meddelande (success, error, info)
         */
        function showNotification(message, type = 'info') {
            // Enkel alert f√∂r nu - kan bytas mot snyggare notification senare
            alert(message);
        }

        /**
         * Rensar inmatningsformul√§ret
         */
        function clearForm() {
            if (!confirm('√Ñr du s√§ker p√• att du vill rensa formul√§ret?')) return;
            
            document.getElementById('raceNotes').value = '';
            
            ['kent', 'lotta', 'bengt', 'benita', 'system'].forEach(pid => {
                document.getElementById(pid + '-race1').value = '';
                document.getElementById(pid + '-race2').value = '';
            });
            
            document.getElementById('winner-race1').value = '';
            document.getElementById('winner-race2').value = '';
            document.getElementById('dd-payout').value = '';
            document.getElementById('result-notes').value = '';
            
            showNotification('Formul√§r rensat!', 'info');
        }

        /**
         * Exporterar historik till CSV
         */
        function exportHistoryCSV() {
            if (weeklyData.length === 0) {
                showNotification('Ingen data att exportera!', 'error');
                return;
            }

            let csv = 'Vecka,Datum,Vinnare L1,Vinnare L2,DD-odds,Kent Tr√§ff,Lotta Tr√§ff,Bengt Tr√§ff,Benita Tr√§ff,System Tr√§ff\n';
            
            weeklyData.forEach(week => {
                const row = [
                    week.week,
                    week.date,
                    week.results.winner_race1 || '',
                    week.results.winner_race2 || '',
                    week.results.dd_payout || ''
                ];

                if (week.results.winner_race1 && week.results.winner_race2) {
                    Object.keys(players).forEach(pid => {
                        const p = week.players[pid];
                        const hit = p.race1.includes(week.results.winner_race1) && p.race2.includes(week.results.winner_race2);
                        row.push(hit ? '1' : '0');
                    });
                } else {
                    row.push('', '', '', '', '');
                }

                csv += row.join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dd_history_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('CSV exporterad!', 'success');
        }

        /**
         * Rensar all data (med varning)
         */
        function clearAllData() {
            if (!confirm('VARNING: Detta kommer radera ALL data permanent. √Ñr du absolut s√§ker?')) return;
            if (!confirm('Sista chansen! All data kommer f√∂rsvinna. Forts√§tt?')) return;
            
            localStorage.removeItem('ddWeeklyData');
            weeklyData = [];
            updateAllDisplays();
            
            showNotification('All data raderad!', 'info');
        }
    </script>
</body>
</html>